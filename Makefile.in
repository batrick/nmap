
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
mandir = @mandir@
srcdir = @srcdir@

CC = @CC@
CCOPT = 
INCLS = -I. 
DEFS = @DEFS@

CFLAGS = @CFLAGS@ $(CCOPT) $(DEFS) $(INCLS)
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@

INSTALL = @INSTALL@
MAKEDEPEND = @MAKEDEPEND@

TARGET = nmap

SRCS = nmap.c targets.c @COMPAT_SRCS@

OBJS = nmap.o targets.o @COMPAT_OBJS@

all: $(TARGET)

$(TARGET): $(OBJS)
	rm -f $@
	$(CC) -o $@ $(OBJS) $(LIBS)

debug: nmap_debug.o targets.c nmap.h 
	$(CC) $(CFLAGS) $(LDFLAGS) -g -DDEBUGGING=1 -o nmap nmap_debug.o targets.c $(LIBS)

nmap_debug.o: nmap.c nmap.h
	$(CC) $(CFLAGS) -g -DDEBUGGING=1 -c -o nmap_debug.o nmap.c

ci: checkin

checkin: 
	ci -u Makefile nmap.c targets.c nmap.h inet_aton.c configure.in config.h.in Makefile.in configure install-sh config.guess config.sub

# For distributing the binary
static: nmap.c targets.c nmap.h Makefile
	gcc -Wall -O2 -static -o nmap nmap.c targets.c -lm
	strip nmap

clean:
	rm -f $(OBJS) $(TARGET)

distclean: clean
	rm -f Makefile Makefile.bak config.h stamp-h stamp-h.in \
	         config.cache config.log config.status

depend:
	$(MAKEDEPEND) $(INCLS) -s "# DO NOT DELETE" -- $(DEFS) -- $(SRCS)

install: all
	$(INSTALL) $(TARGET) $(bindir)/$(TARGET)

uninstall:
	rm -f $(bindir)/$(TARGET)

${srcdir}/configure: configure.in 
	cd ${srcdir} && autoconf

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in: stamp-h.in
${srcdir}/stamp-h.in: configure.in acconfig.h \
	config.h.top config.h.bot
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

# DO NOT DELETE -- Needed by makedepend

