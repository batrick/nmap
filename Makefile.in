
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sbindir = @sbindir@
mandir = @mandir@
srcdir = @srcdir@

CC = @CC@
CCOPT = 
LIBPCAPDIR = @libpcapdir@
INCLS = -I.
DEFS = @DEFS@
CFLAGS = @CFLAGS@ $(CCOPT) $(DEFS) $(INCLS)
LDFLAGS = @LDFLAGS@
LIBS =  @LIBS@ -lpcap
VERSION = 1.60
INSTALL = @INSTALL@
MAKEDEPEND = @MAKEDEPEND@

TARGET = nmap

SRCS = nmap.c targets.c tcpip.c error.c utils.c @COMPAT_SRCS@

OBJS = nmap.o targets.o tcpip.o error.o utils.o @COMPAT_OBJS@

all: $(TARGET)

$(TARGET): $(OBJS) @PCAP_DEPENDS@
	@echo Compiling nmap
	rm -f $@
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

$(LIBPCAPDIR)/libpcap.a: $(LIBPCAPDIR)/Makefile
	@echo Compiling libpcap; cd $(LIBPCAPDIR); $(MAKE)
$(LIBPCAPDIR)/Makefile:
	@echo Configuring libpcap; cd $(LIBPCAPDIR); ./configure

ci: checkin

checkin: 
	ci -u Makefile nmap.c targets.c nmap.h tcpip.c tcpip.h error.c error.h utils.c utils.h inet_aton.c configure.in config.h.in Makefile.in configure install-sh config.guess config.sub

# This target is just for me ... don't you get any ideas --Fyodor
distro: 
	autoconf
	rm -f config.cache
	./configure
	$(MAKE) clean
	$(MAKE) static
	$(MAKE)
	./nmap -h > /dev/null    #Make sure nmap exists
	rm -f docs/nmap.usage.txt	
	./nmap -h > docs/nmap.usage.txt 
	rm -f docs/nmap_manpage.html
	nroff -man docs/nmap.1 | man2html -title 'Nmap network security scanner man page' > docs/nmap_manpage.html
	rm -rf /usr/tmp/nmap-$(VERSION)
	mkdir /usr/tmp/nmap-$(VERSION)
	$(MAKE) clean
	rm -f $(LIBPCAPDIR)/config.cache
	cp -r nmap.c targets.c nmap.h \
	tcpip.c tcpip.h error.c error.h utils.c utils.h inet_aton.c \
	configure.in config.h.in Makefile.in configure install-sh config.guess \
	config.sub INSTALL docs/README docs/copying.html COPYING \
	docs/nmap_doc.html docs/nmap.usage.txt docs/nmap.1 \
	docs/nmap_manpage.html $(LIBPCAPDIR) \
	/usr/tmp/nmap-$(VERSION)
	cd /usr/tmp; \
	tar czf nmap-$(VERSION).tar.gz nmap-$(VERSION)
	rm -rf /usr/tmp/nmap-$(VERSION)

# For distributing the binary
static: 
	cd $(LIBPCAPDIR); $(MAKE)
	$(CC) $(CFLAGS) -static $(LDFLAGS) -o nmap.linux.bin  $(SRCS) $(LIBS)
	strip nmap.linux.bin

clean: @PCAP_CLEAN@ my_clean
my_clean:
	rm -f $(OBJS) $(TARGET)
pcap_clean:
	cd $(LIBPCAPDIR); $(MAKE) clean
pcap_dist_clean:
	cd $(LIBPCAPDIR); $(MAKE) distclean

distclean: my_clean my_distclean @PCAP_DIST_CLEAN@
my_distclean:
	rm -f Makefile Makefile.bak config.h stamp-h stamp-h.in \
	         config.cache config.log config.status


depend:
	$(MAKEDEPEND) $(INCLS) -s "# DO NOT DELETE" -- $(DEFS) -- $(SRCS)

install: all
	$(INSTALL) $(TARGET) $(bindir)/$(TARGET)
	$(INSTALL) docs/$(TARGET).1 $(mandir)/man1/$(TARGET).1

uninstall:
	rm -f $(bindir)/$(TARGET)

${srcdir}/configure: configure.in 
	cd ${srcdir} && autoconf

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in: stamp-h.in
${srcdir}/stamp-h.in: configure.in acconfig.h \
	config.h.top config.h.bot
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

# DO NOT DELETE -- Needed by makedepend

